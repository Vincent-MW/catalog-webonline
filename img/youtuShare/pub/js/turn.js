(function(A){var O,R,F="",B="4.1.0",M=Math.PI,a=M/2,V="ontouchstart" in window,I=(V)?{down:"touchstart",move:"touchmove",up:"touchend",over:"touchstart",out:"touchend"}:{down:"mousedown",move:"mousemove",up:"mouseup",over:"mouseover",out:"mouseout"},Z={backward:["bl","tl"],forward:["br","tr"],all:["tl","bl","tr","br","l","r"]},c=["single","double"],G=["ltr","rtl"],D={acceleration:true,display:"double",duration:600,page:1,gradients:true,turnCorners:"bl,br",when:null},C={cornerSize:200},N=6,S={init:function(i){O="WebKitCSSMatrix" in window||"MozPerspective" in document.body.style;R=J();F=e();var m,l=this,n=0,k=this.data(),j=this.children();i=A.extend({width:this.width(),height:this.height(),direction:this.attr("dir")||this.css("direction")||"ltr"},D,i);k.opts=i;k.pageObjs={};k.pages={};k.pageWrap={};k.pageZoom={};k.pagePlace={};k.pageMv=[];k.zoom=1;k.totalPages=i.pages||0;k.eventHandlers={touchStart:A.proxy(S._touchStart,this),touchMove:A.proxy(S._touchMove,this),touchEnd:A.proxy(S._touchEnd,this),start:A.proxy(S._eventStart,this)};if(i.when){for(m in i.when){if(Y(m,i.when)){this.bind(m,i.when[m])}}}this.css({position:"relative",width:i.width,height:i.height});this.turn("display",i.display);if(i.direction!==""){this.turn("direction",i.direction)}if(O&&!V&&i.acceleration){this.transform(X(0,0,true))}for(m=0;m<j.length;m++){if(A(j[m]).attr("ignore")!="1"){this.turn("addPage",j[m],++n)}}A(this).bind(I.down,k.eventHandlers.touchStart).bind("end",S._eventEnd).bind("pressed",S._eventPressed).bind("released",S._eventReleased).bind("flip",S._flip);A(this).parent().bind("start",k.eventHandlers.start);A(document).bind(I.move,k.eventHandlers.touchMove).bind(I.up,k.eventHandlers.touchEnd);this.turn("page",i.page);k.done=true;return this},addPage:function(j,m){var i,o,k=false,l=this.data(),n=l.totalPages+1;if(l.destroying){return false}if((i=/\bp([0-9]+)\b/.exec(A(j).attr("class")))){m=parseInt(i[1],10)}if(m){if(m==n){k=true}else{if(m>n){throw K('Page "'+m+'" cannot be inserted')}}}else{m=n;k=true}if(m>=1&&m<=n){if(l.display=="double"){o=(m%2)?" odd":" even"}else{o=""}if(l.done){this.turn("stop")}if(m in l.pageObjs){S._movePages.call(this,m,1)}if(k){l.totalPages=n}l.pageObjs[m]=A(j).css({"float":"left"}).addClass("page p"+m+o);if(!h()&&l.pageObjs[m].hasClass("hard")){l.pageObjs[m].removeClass("hard")}S._addPage.call(this,m);S._removeFromDOM.call(this)}return this},_addPage:function(i){var l=this.data(),k=l.pageObjs[i];if(k){if(S._necessPage.call(this,i)){if(!l.pageWrap[i]){l.pageWrap[i]=A("<div/>",{"class":"page-wrapper",page:i,css:{position:"absolute",overflow:"hidden"}});this.append(l.pageWrap[i]);if(!l.pagePlace[i]){l.pagePlace[i]=i;l.pageObjs[i].appendTo(l.pageWrap[i])}var j=S._pageSize.call(this,i,true);k.css({width:j.width,height:j.height});l.pageWrap[i].css(j)}if(l.pagePlace[i]==i){S._makeFlip.call(this,i)}}else{l.pagePlace[i]=0;if(l.pageObjs[i]){l.pageObjs[i].remove()}}}},hasPage:function(i){return Y(i,this.data().pageObjs)},center:function(j){var i=this.data(),l=A(this).turn("size"),m=0;if(!i.noCenter){if(i.display=="double"){var k=this.turn("view",j||i.tpage||i.page);if(i.direction=="ltr"){if(!k[0]){m-=l.width/4}else{if(!k[1]){m+=l.width/4}}}else{if(!k[0]){m+=l.width/4}else{if(!k[1]){m-=l.width/4}}}}A(this).css({marginLeft:m})}return this},destroy:function(){var i,l=this,k=this.data(),j=["end","first","flip","last","pressed","released","start","turning","turned","zooming","missing"];if(W("destroying",this)=="prevented"){return}k.destroying=true;A.each(j,function(n,m){l.unbind(m)});this.parent().unbind("start",k.eventHandlers.start);A(document).unbind(I.move,k.eventHandlers.touchMove).unbind(I.up,k.eventHandlers.touchEnd);while(k.totalPages!==0){this.turn("removePage",k.totalPages)}if(k.fparent){k.fparent.remove()}if(k.shadow){k.shadow.remove()}this.removeData();k=null;return this},is:function(){return typeof(this.data().pages)=="object"},zoom:function(j){var k=this.data();if(typeof(j)=="number"){if(j<0.001||j>100){throw K(j+" is not a value for zoom")}if(W("zooming",this,[j,k.zoom])=="prevented"){return this}var n=this.turn("size"),i=this.turn("view"),o=1/k.zoom,l=Math.round(n.width*o*j),m=Math.round(n.height*o*j);k.zoom=j;A(this).turn("stop").turn("size",l,m);if(k.opts.autoCenter){this.turn("center")}S._updateShadow.call(this);for(var p=0;p<i.length;p++){if(i[p]&&k.pageZoom[i[p]]!=k.zoom){this.trigger("zoomed",[i[p],i,k.pageZoom[i[p]],k.zoom]);k.pageZoom[i[p]]=k.zoom}}return this}else{return k.zoom}},_pageSize:function(m,k){var l=this.data(),i={};if(l.display=="single"){i.width=this.width();i.height=this.height();if(k){i.top=0;i.left=0;i.right="auto"}}else{var j=this.width()/2,n=this.height();if(l.pageObjs[m].hasClass("own-size")){i.width=l.pageObjs[m].width();i.height=l.pageObjs[m].height()}else{i.width=j;i.height=n}if(k){var o=m%2;i.top=(n-i.height)/2;if(l.direction=="ltr"){i[(o)?"right":"left"]=j-i.width;i[(o)?"left":"right"]="auto"}else{i[(o)?"left":"right"]=j-i.width;i[(o)?"right":"left"]="auto"}}}return i},_makeFlip:function(i){var l=this.data();if(!l.pages[i]&&l.pagePlace[i]==i){var k=l.display=="single",j=i%2;l.pages[i]=l.pageObjs[i].css(S._pageSize.call(this,i)).flip({page:i,next:(j||k)?i+1:i-1,turn:this}).flip("disable",l.disabled);S._setPageLoc.call(this,i);l.pageZoom[i]=l.zoom}return l.pages[i]},_makeRange:function(){var i,j,k=this.data();if(k.totalPages<1){return}j=this.turn("range");for(i=j[0];i<=j[1];i++){S._addPage.call(this,i)}},range:function(k){var l,n,m,j,i=this.data();k=k||i.tpage||i.page||1;j=S._view.call(this,k);if(k<1||k>i.totalPages){throw K('"'+k+'" is not a valid page')}j[1]=j[1]||j[0];if(j[0]>=1&&j[1]<=i.totalPages){l=Math.floor((N-2)/2);if(i.totalPages-j[1]>j[0]){n=Math.min(j[0]-1,l);m=2*l-n}else{m=Math.min(i.totalPages-j[1],l);n=2*l-m}}else{n=N-1;m=N-1}return[Math.max(1,j[0]-n),Math.min(i.totalPages,j[1]+m)]},_necessPage:function(i){if(i===0){return true}var j=this.turn("range");return this.data().pageObjs[i].hasClass("fixed")||(i>=j[0]&&i<=j[1])},_removeFromDOM:function(){var i,j=this.data();for(i in j.pageWrap){if(Y(i,j.pageWrap)&&!S._necessPage.call(this,i)){S._removePageFromDOM.call(this,i)}}},_removePageFromDOM:function(i){var k=this.data();if(k.pages[i]){var j=k.pages[i].data();H._moveFoldingPage.call(k.pages[i],false);if(j.f&&j.f.fwrapper){j.f.fwrapper.remove()}k.pages[i].removeData();k.pages[i].remove();delete k.pages[i]}if(k.pageObjs[i]){k.pageObjs[i].remove()}if(k.pageWrap[i]){k.pageWrap[i].remove();delete k.pageWrap[i]}S._removeMv.call(this,i);delete k.pagePlace[i];delete k.pageZoom[i]},removePage:function(i){var j=this.data();if(i=="*"){while(j.totalPages!==0){this.turn("removePage",j.totalPages)}}else{if(i<1||i>j.totalPages){throw K("The page "+i+" doesn't exist")}if(j.pageObjs[i]){this.turn("stop");S._removePageFromDOM.call(this,i);delete j.pageObjs[i]}S._movePages.call(this,i,-1);j.totalPages=j.totalPages-1;if(j.page>j.totalPages){j.page=null;S._fitPage.call(this,j.totalPages)}else{S._makeRange.call(this);this.turn("update")}}return this},_movePages:function(m,o){var i,n=this,l=this.data(),k=l.display=="single",j=function(r){var p=r+o,q=p%2,s=(q)?" odd ":" even ";if(l.pageObjs[r]){l.pageObjs[p]=l.pageObjs[r].removeClass("p"+r+" odd even").addClass("p"+p+s)}if(l.pagePlace[r]&&l.pageWrap[r]){l.pagePlace[p]=p;if(l.pageObjs[p].hasClass("fixed")){l.pageWrap[p]=l.pageWrap[r].attr("page",p)}else{l.pageWrap[p]=l.pageWrap[r].css(S._pageSize.call(n,p,true)).attr("page",p)}if(l.pages[r]){l.pages[p]=l.pages[r].flip("options",{page:p,next:(k||q)?p+1:p-1})}if(o){delete l.pages[r];delete l.pagePlace[r];delete l.pageZoom[r];delete l.pageObjs[r];delete l.pageWrap[r]}}};if(o>0){for(i=l.totalPages;i>=m;i--){j(i)}}else{for(i=m;i<=l.totalPages;i++){j(i)}}},display:function(k){var l=this.data(),j=l.display;if(k===undefined){return j}else{if(A.inArray(k,c)==-1){throw K('"'+k+'" is not a value for display')}switch(k){case"single":if(!l.pageObjs[0]){this.turn("stop").css({"overflow":"hidden"});l.pageObjs[0]=A("<div />",{"class":"page p-temporal"}).css({width:this.width(),height:this.height()}).appendTo(this)}this.addClass("shadow");break;case"double":if(l.pageObjs[0]){this.turn("stop").css({"overflow":""});l.pageObjs[0].remove();delete l.pageObjs[0]}this.removeClass("shadow");break}l.display=k;if(j){var i=this.turn("size");S._movePages.call(this,1,0);this.turn("size",i.width,i.height).turn("update")}return this}},direction:function(i){var j=this.data();if(i===undefined){return j.direction}else{i=i.toLowerCase();if(A.inArray(i,G)==-1){throw K('"'+i+'" is not a value for direction')}if(i=="rtl"){A(this).attr("dir","ltr").css({direction:"ltr"})}j.direction=i;if(j.done){this.turn("size",A(this).width(),A(this).height())}return this}},animating:function(){return this.data().pageMv.length>0},corner:function(){var j,i,k=this.data();for(i in k.pages){if(Y(i,k.pages)){if((j=k.pages[i].flip("corner"))){return j}}}return false},data:function(){return this.data()},disable:function(i){var k,l=this.data(),j=this.turn("view");l.disabled=i===undefined||i===true;for(k in l.pages){if(Y(k,l.pages)){l.pages[k].flip("disable",(l.disabled)?true:A.inArray(parseInt(k,10),j)==-1)}}return this},disabled:function(i){if(i===undefined){return this.data().disabled===true}else{return this.turn("disable",i)}},size:function(m,l){if(m===undefined||l===undefined){return{width:this.width(),height:this.height()}}else{this.turn("stop");var k,j,n=this.data(),i=(n.display=="double")?m/2:m;this.css({width:m,height:l});if(n.pageObjs[0]){n.pageObjs[0].css({width:i,height:l})}for(k in n.pageWrap){if(!Y(k,n.pageWrap)){continue}j=S._pageSize.call(this,k,true);n.pageObjs[k].css({width:j.width,height:j.height});n.pageWrap[k].css(j);if(n.pages[k]){n.pages[k].css({width:j.width,height:j.height})}}this.turn("resize");return this}},resize:function(){var i,j=this.data();if(j.pages[0]){j.pageWrap[0].css({left:-this.width()});j.pages[0].flip("resize",true)}for(i=1;i<=j.totalPages;i++){if(j.pages[i]){j.pages[i].flip("resize",true)}}S._updateShadow.call(this);if(j.opts.autoCenter){this.turn("center")}},_removeMv:function(i){var j,k=this.data();for(j=0;j<k.pageMv.length;j++){if(k.pageMv[j]==i){k.pageMv.splice(j,1);return true}}return false},_addMv:function(i){var j=this.data();S._removeMv.call(this,i);j.pageMv.push(i)},_view:function(i){var j=this.data();i=i||j.page;if(j.display=="double"){return(i%2)?[i-1,i]:[i,i+1]}else{return[i]}},view:function(i){var k=this.data(),j=S._view.call(this,i);if(k.display=="double"){return[(j[0]>0)?j[0]:0,(j[1]<=k.totalPages)?j[1]:0]}else{return[(j[0]>0&&j[0]<=k.totalPages)?j[0]:0]}},stop:function(i,m){if(this.turn("animating")){var j,l,n,k=this.data();if(k.tpage){k.page=k.tpage;delete k["tpage"]}for(j=0;j<k.pageMv.length;j++){if(!k.pageMv[j]||k.pageMv[j]===i){continue}n=k.pages[k.pageMv[j]];l=n.data().f.opts;n.flip("hideFoldedPage",m);if(!m){H._moveFoldingPage.call(n,false)}if(l.force){l.next=(l.page%2===0)?l.page-1:l.page+1;delete l["force"]}}}this.turn("update");return this},pages:function(i){var k=this.data();if(i){if(i<k.totalPages){for(var j=k.totalPages;j>i;j--){this.turn("removePage",j)}}k.totalPages=i;S._fitPage.call(this,k.page);return this}else{return k.totalPages}},_missing:function(j){var i=this.data();if(i.totalPages<1){return}var m,k=this.turn("range",j),l=[];for(m=k[0];m<=k[1];m++){if(!i.pageObjs[m]){l.push(m)}}if(l.length>0){this.trigger("missing",[l])}},_fitPage:function(j){var i=this.data(),k=this.turn("view",j);S._missing.call(this,j);if(!i.pageObjs[j]){return}i.page=j;this.turn("stop");for(var l=0;l<k.length;l++){if(k[l]&&i.pageZoom[k[l]]!=i.zoom){this.trigger("zoomed",[k[l],k,i.pageZoom[k[l]],i.zoom]);i.pageZoom[k[l]]=i.zoom}}S._removeFromDOM.call(this);S._makeRange.call(this);S._updateShadow.call(this);this.trigger("turned",[j,k]);this.turn("update");if(i.opts.autoCenter){this.turn("center")}},_turnPage:function(r){var i,j,l=this.data(),s=l.pagePlace[r],o=this.turn("view"),t=this.turn("view",r);if(l.page!=r){var p=l.page;if(W("turning",this,[r,t])=="prevented"){if(p==l.page&&A.inArray(s,l.pageMv)!=-1){l.pages[s].flip("hideFoldedPage",true)}return}if(A.inArray(1,t)!=-1){this.trigger("first")}if(A.inArray(l.totalPages,t)!=-1){this.trigger("last")}}if(l.display=="single"){i=o[0];j=t[0]}else{if(o[1]&&r>o[1]){i=o[1];j=t[0]}else{if(o[0]&&r<o[0]){i=o[0];j=t[1]}}}var n=l.opts.turnCorners.split(","),q=l.pages[i].data().f,m=q.opts,k=q.point;S._missing.call(this,r);if(!l.pageObjs[r]){return}this.turn("stop");l.page=r;S._makeRange.call(this);l.tpage=j;if(m.next!=j){m.next=j;m.force=true}this.turn("update");q.point=k;if(q.effect=="hard"){if(l.direction=="ltr"){l.pages[i].flip("turnPage",(r>i)?"r":"l")}else{l.pages[i].flip("turnPage",(r>i)?"l":"r")}}else{if(l.direction=="ltr"){l.pages[i].flip("turnPage",n[(r>i)?1:0])}else{l.pages[i].flip("turnPage",n[(r>i)?0:1])}}},page:function(i){var j=this.data();if(i===undefined){return j.page}else{if(!j.disabled&&!j.destroying){i=parseInt(i,10);if(i>0&&i<=j.totalPages){if(i!=j.page){if(!j.done||A.inArray(i,this.turn("view"))!=-1){S._fitPage.call(this,i)}else{S._turnPage.call(this,i)}}return this}else{throw K("The page "+i+" does not exist")}}}},next:function(){return this.turn("page",Math.min(this.data().totalPages,S._view.call(this,this.data().page).pop()+1))},previous:function(){return this.turn("page",Math.max(1,S._view.call(this,this.data().page).shift()-1))},peel:function(m,l){var i=this.data(),k=this.turn("view");l=(l===undefined)?true:l===true;if(m===false){this.turn("stop",null,l)}else{if(i.display=="single"){i.pages[i.page].flip("peel",m,l)}else{var j;if(i.direction=="ltr"){j=(m.indexOf("l")!=-1)?k[0]:k[1]}else{j=(m.indexOf("l")!=-1)?k[1]:k[0]}if(i.pages[j]){i.pages[j].flip("peel",m,l)}}}return this},_addMotionPage:function(){var i=A(this).data().f.opts,j=i.turn,k=j.data();S._addMv.call(j,i.page)},_eventStart:function(l,j,m){var i=j.turn.data(),k=i.pageZoom[j.page];if(l.isDefaultPrevented()){S._updateShadow.call(j.turn);return}if(k&&k!=i.zoom){j.turn.trigger("zoomed",[j.page,j.turn.turn("view",j.page),k,i.zoom]);i.pageZoom[j.page]=i.zoom}if(i.display=="single"&&m){if((m.charAt(1)=="l"&&i.direction=="ltr")||(m.charAt(1)=="r"&&i.direction=="rtl")){j.next=(j.next<j.page)?j.next:j.page-1;j.force=true}else{j.next=(j.next>j.page)?j.next:j.page+1}}S._addMotionPage.call(l.target);S._updateShadow.call(j.turn)},_eventEnd:function(l,i,n){var j=A(l.target),k=j.data().f,o=i.turn,m=o.data();if(n){var p=m.tpage||m.page;if(p==i.next||p==i.page){delete m.tpage;S._fitPage.call(o,p||i.next,true)}}else{S._removeMv.call(o,i.page);S._updateShadow.call(o);o.turn("update")}},_eventPressed:function(n){var k,j=A(n.target).data().f,m=j.opts.turn,i=m.data(),l=i.pages;i.mouseAction=true;m.turn("update");return j.time=new Date().getTime()},_eventReleased:function(j,l){var n,m=A(j.target),i=m.data().f,o=i.opts.turn,k=o.data();if(k.display=="single"){n=(l.corner=="br"||l.corner=="tr")?l.x<m.width()/2:l.x>m.width()/2}else{n=l.x<0||l.x>m.width()}if((new Date()).getTime()-i.time<200||n){j.preventDefault();S._turnPage.call(o,i.opts.next)}k.mouseAction=false},_flip:function(j){j.stopPropagation();var i=A(j.target).data().f.opts;i.turn.trigger("turn",[i.next]);if(i.turn.data().opts.autoCenter){i.turn.turn("center",i.next)}},_touchStart:function(){var j=this.data();for(var i in j.pages){if(Y(i,j.pages)&&H._eventStart.apply(j.pages[i],arguments)===false){return false}}},_touchMove:function(){var j=this.data();for(var i in j.pages){if(Y(i,j.pages)){H._eventMove.apply(j.pages[i],arguments)}}},_touchEnd:function(){var j=this.data();for(var i in j.pages){if(Y(i,j.pages)){H._eventEnd.apply(j.pages[i],arguments)}}},calculateZ:function(s){var u,i,o,q,m,j=this,n=this.data(),t=this.turn("view"),r=t[0]||t[1],p=s.length-1,k={pageZ:{},partZ:{},pageV:{}},l=function(w){var v=j.turn("view",w);if(v[0]){k.pageV[v[0]]=true}if(v[1]){k.pageV[v[1]]=true}};for(u=0;u<=p;u++){i=s[u];o=n.pages[i].data().f.opts.next;q=n.pagePlace[i];l(i);l(o);m=(n.pagePlace[o]==o)?o:i;k.pageZ[m]=n.totalPages-Math.abs(r-m);k.partZ[q]=n.totalPages*2-p+u}return k},update:function(){var p,k=this.data();if(this.turn("animating")&&k.pageMv[0]!==0){var n,j,o,m=this.turn("calculateZ",k.pageMv),i=this.turn("corner"),l=this.turn("view"),r=this.turn("view",k.tpage);for(p in k.pageWrap){if(!Y(p,k.pageWrap)){continue}o=k.pageObjs[p].hasClass("fixed");k.pageWrap[p].css({display:(m.pageV[p]||o)?"":"none",zIndex:(k.pageObjs[p].hasClass("hard")?m.partZ[p]:m.pageZ[p])||(o?-1:0)});if((n=k.pages[p])){n.flip("z",m.partZ[p]||null);if(m.pageV[p]){n.flip("resize")}if(k.tpage){n.flip("hover",false).flip("disable",A.inArray(parseInt(p,10),k.pageMv)==-1&&p!=r[0]&&p!=r[1])}else{n.flip("hover",i===false).flip("disable",p!=l[0]&&p!=l[1])}}}}else{for(p in k.pageWrap){if(!Y(p,k.pageWrap)){continue}var q=S._setPageLoc.call(this,p);if(k.pages[p]){k.pages[p].flip("disable",k.disabled||q!=1).flip("hover",true).flip("z",null)}}}return this},_updateShadow:function(){var n,m,i,k=this.data(),j=this.width(),l=this.height(),o=(k.display=="single")?j:j/2;n=this.turn("view");if(!k.shadow){k.shadow=A("<div />",{"class":"shadow","css":d(0,0,0).css}).appendTo(this)}for(var p=0;p<k.pageMv.length;p++){if(!n[0]||!n[1]){break}n=this.turn("view",k.pages[k.pageMv[p]].data().f.opts.next);m=this.turn("view",k.pageMv[p]);n[0]=n[0]&&m[0];n[1]=n[1]&&m[1]}if(!n[0]){i=(k.direction=="ltr")?1:2}else{if(!n[1]){i=(k.direction=="ltr")?2:1}else{i=3}}switch(i){case 1:k.shadow.css({width:o,height:l,top:0,left:o});break;case 2:k.shadow.css({width:o,height:l,top:0,left:0});break;case 3:k.shadow.css({width:j,height:l,top:0,left:0});break}},_setPageLoc:function(i){var l=this.data(),j=this.turn("view"),k=0;if(i==j[0]||i==j[1]){k=1}else{if((l.display=="single"&&i==j[0]+1)||(l.display=="double"&&i==j[0]-2||i==j[1]+2)){k=2}}if(!this.turn("animating")){switch(k){case 1:l.pageWrap[i].css({zIndex:l.totalPages,display:""});break;case 2:l.pageWrap[i].css({zIndex:l.totalPages-1,display:""});break;case 0:l.pageWrap[i].css({zIndex:0,display:(l.pageObjs[i].hasClass("fixed"))?"":"none"});break}}return k},options:function(i){if(i===undefined){return this.data().opts}else{var k=this.data();A.extend(k.opts,i);if(i.pages){this.turn("pages",i.pages)}if(i.page){this.turn("page",i.page)}if(i.display){this.turn("display",i.display)}if(i.direction){this.turn("direction",i.direction)}if(i.width&&i.height){this.turn("size",i.width,i.height)}if(i.when){for(var j in i.when){if(Y(j,i.when)){this.unbind(j).bind(j,i.when[j])}}}return this}},version:function(){return B}},H={init:function(i){this.data({f:{disabled:false,hover:false,effect:(this.hasClass("hard"))?"hard":"sheet"}});this.flip("options",i);H._addPageWrapper.call(this);return this},setData:function(i){var j=this.data();j.f=A.extend(j.f,i);return this},options:function(i){var j=this.data().f;if(i){H.setData.call(this,{opts:A.extend({},j.opts||C,i)});return this}else{return j.opts}},z:function(i){var j=this.data().f;j.opts["z-index"]=i;if(j.fwrapper){j.fwrapper.css({zIndex:i||parseInt(j.parent.css("z-index"),10)||0})}return this},_cAllowed:function(){var l=this.data().f,i=l.opts.page,k=l.opts.turn.data(),j=i%2;if(l.effect=="hard"){return(k.direction=="ltr")?[(j)?"r":"l"]:[(j)?"l":"r"]}else{if(k.display=="single"){if(i==1){return(k.direction=="ltr")?Z["forward"]:Z["backward"]}else{if(i==k.totalPages){return(k.direction=="ltr")?Z["backward"]:Z["forward"]}else{return Z["all"]}}}else{return(k.direction=="ltr")?Z[(j)?"forward":"backward"]:Z[(j)?"backward":"forward"]}}},_cornerActivated:function(k){var l=this.data().f,i=this.width(),n=this.height(),o={x:k.x,y:k.y,corner:""},j=l.opts.cornerSize;if(o.x<=0||o.y<=0||o.x>=i||o.y>=n){return false}var m=H._cAllowed.call(this);switch(l.effect){case"hard":if(o.x>i-j){o.corner="r"}else{if(o.x<j){o.corner="l"}else{return false}}break;case"sheet":if(o.y<j){o.corner+="t"}else{if(o.y>=n-j){o.corner+="b"}else{return false}}if(o.x<=j){o.corner+="l"}else{if(o.x>=i-j){o.corner+="r"}else{return false}}break}return(!o.corner||A.inArray(o.corner,m)==-1)?false:o},_isIArea:function(j){var i=this.data().f.parent.offset();j=(V&&j.originalEvent)?j.originalEvent.touches[0]:j;return H._cornerActivated.call(this,{x:j.pageX-i.left,y:j.pageY-i.top})},_c:function(j,i){i=i||0;switch(j){case"tl":return f(i,i);case"tr":return f(this.width()-i,i);case"bl":return f(i,this.height()-i);case"br":return f(this.width()-i,this.height()-i);case"l":return f(i,0);case"r":return f(this.width()-i,0)}},_c2:function(i){switch(i){case"tl":return f(this.width()*2,0);case"tr":return f(-this.width(),0);case"bl":return f(this.width()*2,this.height());case"br":return f(-this.width(),this.height());case"l":return f(this.width()*2,0);case"r":return f(-this.width(),0)}},_foldingPage:function(){var j=this.data().f;if(!j){return}var i=j.opts;if(i.turn){j=i.turn.data();if(j.display=="single"){return(i.next>1||i.page>1)?j.pageObjs[0]:null}else{return j.pageObjs[i.next]}}},_backGradient:function(){var k=this.data().f,i=k.opts.turn.data(),j=i.opts.gradients&&(i.display=="single"||(k.opts.page!=2&&k.opts.page!=i.totalPages-1));if(j&&!k.bshadow){k.bshadow=A("<div/>",d(0,0,1)).css({"position":"",width:this.width(),height:this.height()}).appendTo(k.parent)}return j},type:function(){return this.data().f.effect},resize:function(n){var l=this.data().f,m=l.opts.turn.data(),o=this.width(),i=this.height();switch(l.effect){case"hard":if(n){l.wrapper.css({width:o,height:i});l.fpage.css({width:o,height:i});if(m.opts.gradients){l.ashadow.css({width:o,height:i});l.bshadow.css({width:o,height:i})}}break;case"sheet":if(n){var j=Math.round(Math.sqrt(Math.pow(o,2)+Math.pow(i,2)));l.wrapper.css({width:j,height:j});l.fwrapper.css({width:j,height:j}).children(":first-child").css({width:o,height:i});l.fpage.css({width:o,height:i});if(m.opts.gradients){l.ashadow.css({width:o,height:i})}if(H._backGradient.call(this)){l.bshadow.css({width:o,height:i})}}if(l.parent.is(":visible")){var k=Q(l.parent[0]);l.fwrapper.css({top:k.top,left:k.left});k=Q(l.opts.turn[0]);l.fparent.css({top:-k.top,left:-k.left})}this.flip("z",l.opts["z-index"]);break}},_addPageWrapper:function(){var j,l=this.data().f,q=l.opts.turn.data(),o=this.parent();l.parent=o;if(!l.wrapper){switch(l.effect){case"hard":var n={};n[F+"transform-style"]="preserve-3d";n[F+"backface-visibility"]="hidden";l.wrapper=A("<div/>",d(0,0,2)).css(n).appendTo(o).prepend(this);l.fpage=A("<div/>",d(0,0,1)).css(n).appendTo(o);if(q.opts.gradients){l.ashadow=A("<div/>",d(0,0,0)).hide().appendTo(o);l.bshadow=A("<div/>",d(0,0,0))}break;case"sheet":var i=this.width(),p=this.height(),m=Math.round(Math.sqrt(Math.pow(i,2)+Math.pow(p,2)));l.fparent=l.opts.turn.data().fparent;if(!l.fparent){var k=A("<div/>",{css:{"pointer-events":"none"}}).hide();k.data().flips=0;k.css(d(0,0,"auto","visible").css).appendTo(l.opts.turn);l.opts.turn.data().fparent=k;l.fparent=k}this.css({position:"absolute",top:0,left:0,bottom:"auto",right:"auto"});l.wrapper=A("<div/>",d(0,0,this.css("z-index"))).appendTo(o).prepend(this);l.fwrapper=A("<div/>",d(o.offset().top,o.offset().left)).hide().appendTo(l.fparent);l.fpage=A("<div/>",d(0,0,0,"visible")).css({cursor:"default"}).appendTo(l.fwrapper);if(q.opts.gradients){l.ashadow=A("<div/>",d(0,0,1)).appendTo(l.fpage)}H.setData.call(this,l);break}}H.resize.call(this,true)},_fold:function(o){var Ab=this.data().f,z=Ab.opts.turn.data(),Ad=H._c.call(this,o.corner),q=this.width(),i=this.height();switch(Ab.effect){case"hard":if(o.corner=="l"){o.x=Math.min(Math.max(o.x,0),q*2)}else{o.x=Math.max(Math.min(o.x,q),-q)}var p,Ao,Ae,Ag,y,k=z.totalPages,l=Ab.opts["z-index"]||k,t={"overflow":"visible"},Af=(Ad.x)?(Ad.x-o.x)/q:o.x/q,Ai=Af*90,Ar=Ai<90;switch(o.corner){case"l":Ag="0% 50%";y="100% 50%";if(Ar){p=0;Ao=Ab.opts.next-1>0;Ae=1}else{p="100%";Ao=Ab.opts.page+1<k;Ae=0}break;case"r":Ag="100% 50%";y="0% 50%";Ai=-Ai;q=-q;if(Ar){p=0;Ao=Ab.opts.next+1<k;Ae=0}else{p="-100%";Ao=Ab.opts.page!=1;Ae=1}break}t[F+"perspective-origin"]=y;Ab.wrapper.transform("rotateY("+Ai+"deg)translate3d(0px, 0px, "+(this.attr("depth")||0)+"px)",y);Ab.fpage.transform("translateX("+q+"px) rotateY("+(180+Ai)+"deg)",Ag);Ab.parent.css(t);if(Ar){Af=-Af+1;Ab.wrapper.css({zIndex:l+1});Ab.fpage.css({zIndex:l})}else{Af=Af-1;Ab.wrapper.css({zIndex:l});Ab.fpage.css({zIndex:l+1})}if(z.opts.gradients){if(Ao){Ab.ashadow.css({display:"",left:p,backgroundColor:"rgba(0,0,0,"+(0.5*Af)+")"}).transform("rotateY(0deg)")}else{Ab.ashadow.hide()}Ab.bshadow.css({opacity:-Af+1});if(Ar){if(Ab.bshadow.parent()[0]!=Ab.wrapper[0]){Ab.bshadow.appendTo(Ab.wrapper)}}else{if(Ab.bshadow.parent()[0]!=Ab.fpage[0]){Ab.bshadow.appendTo(Ab.fpage)}}T(Ab.bshadow,f(Ae*100,0),f((-Ae+1)*100,0),[[0,"rgba(0,0,0,0.3)"],[1,"rgba(0,0,0,0)"]],2)}break;case"sheet":var Ah=this,Ac=0,x=0,Aq,Ax,n,Aa,Av,At,m,Ap,j=f(0,0),Aj=f(0,0),s=f(0,0),Al=H._foldingPage.call(this),r=Math.tan(x),v=z.opts.acceleration,w=Ab.wrapper.height(),Am=o.corner.substr(0,1)=="t",An=o.corner.substr(1,1)=="l",Ak=function(){var AC=f(0,0);var AB=f(0,0);AC.x=(Ad.x)?Ad.x-o.x:o.x;if(!R){AC.y=0}else{AC.y=(Ad.y)?Ad.y-o.y:o.y}AB.x=(An)?q-AC.x/2:o.x+AC.x/2;AB.y=AC.y/2;var AD=a-Math.atan2(AC.y,AC.x),AG=AD-Math.atan2(AB.y,AB.x),AE=Math.max(0,Math.sin(AG)*Math.sqrt(Math.pow(AB.x,2)+Math.pow(AB.y,2)));Ac=E(AD);s=f(AE*Math.sin(AD),AE*Math.cos(AD));if(AD>a){s.x=s.x+Math.abs(s.y*AC.y/AC.x);s.y=0;if(Math.round(s.x*Math.tan(M-AD))<i){o.y=Math.sqrt(Math.pow(i,2)+2*AB.x*AC.x);if(Am){o.y=i-o.y}return Ak()}}if(AD>a){var Az=M-AD,AA=w-i/Math.sin(Az);j=f(Math.round(AA*Math.cos(Az)),Math.round(AA*Math.sin(Az)));if(An){j.x=-j.x}if(Am){j.y=-j.y}}Ax=Math.round(s.y/Math.tan(AD)+s.x);var Aw=q-Ax,Au=Aw*Math.cos(AD*2),Ay=Aw*Math.sin(AD*2);Aj=f(Math.round((An?Aw-Au:Ax+Au)),Math.round((Am)?Ay:i-Ay));if(z.opts.gradients){At=Aw*Math.sin(AD);var As=H._c2.call(Ah,o.corner),AF=Math.sqrt(Math.pow(As.x-o.x,2)+Math.pow(As.y-o.y,2))/q;Ap=Math.sin(a*((AF>1)?2-AF:AF));m=Math.min(AF,1);Av=At>100?(At-100)/At:0;n=f(At*Math.sin(AD)/q*100,At*Math.cos(AD)/i*100);if(H._backGradient.call(Ah)){Aa=f(At*1.2*Math.sin(AD)/q*100,At*1.2*Math.cos(AD)/i*100);if(!An){Aa.x=100-Aa.x}if(!Am){Aa.y=100-Aa.y}}}s.x=Math.round(s.x);s.y=Math.round(s.y);return true},u=function(Au,AD,AF,Ay){var AB=["0","auto"],AC=(q-w)*AF[0]/100,AE=(i-w)*AF[1]/100,AA={left:AB[AD[0]],top:AB[AD[1]],right:AB[AD[2]],bottom:AB[AD[3]]},Aw={},Az=(Ay!=90&&Ay!=-90)?(An?-1:1):0,As=AF[0]+"% "+AF[1]+"%";Ah.css(AA).transform(P(Ay)+X(Au.x+Az,Au.y,v),As);Ab.fpage.css(AA).transform(P(Ay)+X(Au.x+Aj.x-j.x-q*AF[0]/100,Au.y+Aj.y-j.y-i*AF[1]/100,v)+P((180/Ay-2)*Ay),As);Ab.wrapper.transform(X(-Au.x+AC-Az,-Au.y+AE,v)+P(-Ay),As);Ab.fwrapper.transform(X(-Au.x+j.x+AC,-Au.y+j.y+AE,v)+P(-Ay),As);if(z.opts.gradients){if(AF[0]){n.x=100-n.x}if(AF[1]){n.y=(100-n.y)}Aw["box-shadow"]="0 0 20px rgba(0,0,0,"+(0.5*Ap)+")";Al.css(Aw);T(Ab.ashadow,f(An?100:0,Am?0:100),f(n.x,n.y),[[Av,"rgba(0,0,0,0)"],[((1-Av)*0.8)+Av,"rgba(0,0,0,"+(0.2*m)+")"],[1,"rgba(255,255,255,"+(0.2*m)+")"]],3,x);if(H._backGradient.call(Ah)){T(Ab.bshadow,f(An?0:100,Am?0:100),f(Aa.x,Aa.y),[[0.6,"rgba(0,0,0,0)"],[0.8,"rgba(0,0,0,"+(0.3*m)+")"],[1,"rgba(0,0,0,0)"]],3)}}};switch(o.corner){case"l":break;case"r":break;case"tl":o.x=Math.max(o.x,1);Ak();u(s,[1,0,0,1],[100,0],Ac);break;case"tr":o.x=Math.min(o.x,q-1);Ak();u(f(-s.x,s.y),[0,0,0,1],[0,0],-Ac);break;case"bl":o.x=Math.max(o.x,1);Ak();u(f(s.x,-s.y),[1,1,0,0],[100,100],-Ac);break;case"br":o.x=Math.min(o.x,q-1);Ak();u(f(-s.x,-s.y),[0,1,1,0],[0,100],Ac);break}break}Ab.point=o},_moveFoldingPage:function(i){var j=this.data().f;if(!j){return}var o=j.opts.turn,p=o.data(),n=p.pagePlace;if(i){var l=j.opts.next;if(n[l]!=j.opts.page){if(j.folding){H._moveFoldingPage.call(this,false)}var k=H._foldingPage.call(this);k.appendTo(j.fpage);n[l]=j.opts.page;j.folding=l}o.turn("update")}else{if(j.folding){if(p.pages[j.folding]){var m=p.pages[j.folding].data().f;p.pageObjs[j.folding].appendTo(m.wrapper)}else{if(p.pageWrap[j.folding]){p.pageObjs[j.folding].appendTo(p.pageWrap[j.folding])}}if(j.folding in n){n[j.folding]=j.folding}delete j.folding}}},_showFoldedPage:function(l,j){var p=H._foldingPage.call(this),m=this.data(),k=m.f,n=k.visible;if(p){if(!n||!k.point||k.point.corner!=l.corner){var q=(k.status=="hover"||k.status=="peel"||k.opts.turn.data().mouseAction)?l.corner:null;n=false;if(W("start",this,[k.opts,q])=="prevented"){return false}}if(j){var i=this,o=(k.point&&k.point.corner==l.corner)?k.point:H._c.call(this,l.corner,1);this.animatef({from:[o.x,o.y],to:[l.x,l.y],duration:500,frame:function(r){l.x=Math.round(r[0]);l.y=Math.round(r[1]);H._fold.call(i,l)}})}else{H._fold.call(this,l);if(m.effect&&!m.effect.turning){this.animatef(false)}}if(!n){switch(k.effect){case"hard":k.visible=true;H._moveFoldingPage.call(this,true);k.fpage.show();if(k.opts.shadows){k.bshadow.show()}break;case"sheet":k.visible=true;k.fparent.show().data().flips++;H._moveFoldingPage.call(this,true);k.fwrapper.show();if(k.bshadow){k.bshadow.show()}break}}return true}return false},hide:function(){var k=this.data().f,i=k.opts.turn.data(),j=H._foldingPage.call(this);switch(k.effect){case"hard":if(i.opts.gradients){k.bshadowLoc=0;k.bshadow.remove();k.ashadow.hide()}k.wrapper.transform("");k.fpage.hide();break;case"sheet":if((--k.fparent.data().flips)===0){k.fparent.hide()}this.css({left:0,top:0,right:"auto",bottom:"auto"}).transform("");k.wrapper.transform("");k.fwrapper.hide();if(k.bshadow){k.bshadow.hide()}j.transform("");break}k.visible=false;return this},hideFoldedPage:function(m){var n=this.data().f;if(!n.point){return}var k=this,l=n.point,o=function(){n.point=null;n.status="";k.flip("hide");k.trigger("end",[n.opts,false])};if(m){var r=H._c.call(this,l.corner),j=(l.corner.substr(0,1)=="t"),i=(j)?Math.min(0,l.y-r.y)/2:Math.max(0,l.y-r.y)/2,q=f(l.x,l.y+i),p=f(r.x,r.y-i);this.animatef({from:0,to:1,frame:function(t){var s=g(l,q,p,r,t);l.x=s.x;l.y=s.y;H._fold.call(k,l)},complete:o,duration:800,hiding:true})}else{this.animatef(false);o()}},turnPage:function(i){var l=this,j=this.data().f,k=j.opts.turn.data();i={corner:(j.corner)?j.corner.corner:i||H._cAllowed.call(this)[0]};var n=j.point||H._c.call(this,i.corner,(j.opts.turn)?k.opts.elevation:0),m=H._c2.call(this,i.corner);this.trigger("flip").animatef({from:0,to:1,frame:function(o){var p=g(n,n,m,m,o);i.x=p.x;i.y=p.y;H._showFoldedPage.call(l,i)},complete:function(){l.trigger("end",[j.opts,true])},duration:k.opts.duration,turning:true});j.corner=null},moving:function(){return"effect" in this.data()},isTurning:function(){return this.flip("moving")&&this.data().effect.turning},corner:function(){return this.data().f.corner},_eventStart:function(j){var k=this.data().f,i=k.opts.turn;if(!k.corner&&!k.disabled&&!this.flip("isTurning")&&k.opts.page==i.data().pagePlace[k.opts.page]){k.corner=H._isIArea.call(this,j);if(k.corner&&H._foldingPage.call(this)){this.trigger("pressed",[k.point]);H._showFoldedPage.call(this,k.corner);return false}else{k.corner=null}}},_eventMove:function(l){var i=this.data().f;if(!i.disabled){l=(V)?l.originalEvent.touches:[l];if(i.corner){var k=i.parent.offset();i.corner.x=l[0].pageX-k.left;i.corner.y=l[0].pageY-k.top;H._showFoldedPage.call(this,i.corner)}else{if(i.hover&&!this.data().effect&&this.is(":visible")){var j=H._isIArea.call(this,l[0]);if(j){if((i.effect=="sheet"&&j.corner.length==2)||i.effect=="hard"){i.status="hover";var m=H._c.call(this,j.corner,i.opts.cornerSize/2);j.x=m.x;j.y=m.y;H._showFoldedPage.call(this,j,true)}}else{if(i.status=="hover"){i.status="";H.hideFoldedPage.call(this,true)}}}}}},_eventEnd:function(){var j=this.data().f,i=j.corner;if(!j.disabled&&i){if(W("released",this,[j.point||i])!="prevented"){H.hideFoldedPage.call(this,true)}}j.corner=null},disable:function(i){H.setData.call(this,{"disabled":i});return this},hover:function(i){H.setData.call(this,{"hover":i});return this},peel:function(k,j){var l=this.data().f;if(k){if(A.inArray(k,Z.all)==-1){throw K("Corner "+k+" is not permitted")}if(A.inArray(k,H._cAllowed.call(this))!=-1){var i=H._c.call(this,k,l.opts.cornerSize/2);l.status="peel";H._showFoldedPage.call(this,{corner:k,x:i.x,y:i.y},j)}}else{l.status="";H.hideFoldedPage.call(this,j)}return this}};function U(i,k,j){if(!j[0]||typeof(j[0])=="object"){return k.init.apply(i,j)}else{if(k[j[0]]){return k[j[0]].apply(i,Array.prototype.slice.call(j,1))}else{throw K(j[0]+" is not a method or property")}}}function d(i,j,k,l){return{"css":{position:"absolute",top:i,left:j,"overflow":l||"hidden",zIndex:k||"auto"}}}function g(j,n,p,m,o){var k=1-o,l=k*k*k,i=o*o*o;return f(Math.round(l*j.x+3*o*k*k*n.x+3*o*o*k*p.x+i*m.x),Math.round(l*j.y+3*o*k*k*n.y+3*o*o*k*p.y+i*m.y))}function L(i){return i/180*M}function E(i){return i/M*180}function f(i,j){return{x:i,y:j}}function J(){var j;if((j=/AppleWebkit\/([0-9\.]+)/i.exec(navigator.userAgent))){var i=parseFloat(j[1]);return(i>534.3)}else{return true}}function X(i,j,k){return(O&&k)?" translate3d("+i+"px,"+j+"px, 0px) ":" translate("+i+"px, "+j+"px) "}function P(i){return" rotate("+i+"deg) "}function Y(i,j){return Object.prototype.hasOwnProperty.call(j,i)}function e(){var k=["Moz","Webkit","Khtml","O","ms"],i=k.length,j="";while(i--){if((k[i]+"Transform") in document.body.style){j="-"+k[i].toLowerCase()+"-"}}return j}function b(){var i,j=document.createElement("fakeelement"),k={"transition":"transitionend","OTransition":"oTransitionEnd","MSTransition":"transitionend","MozTransition":"transitionend","WebkitTransition":"webkitTransitionEnd"};for(i in k){if(j.style[i]!==undefined){return k[i]}}}function T(m,i,n,o,u){var x,k=[];if(F=="-webkit-"){for(x=0;x<u;x++){k.push("color-stop("+o[x][0]+", "+o[x][1]+")")}m.css({"background-image":"-webkit-gradient(linear, "+i.x+"% "+i.y+"%,"+n.x+"% "+n.y+"%, "+k.join(",")+" )"})}else{i={x:i.x/100*m.width(),y:i.y/100*m.height()};n={x:n.x/100*m.width(),y:n.y/100*m.height()};var q=n.x-i.x,z=n.y-i.y,p=Math.atan2(z,q),v=p-Math.PI/2,w=Math.abs(m.width()*Math.sin(v))+Math.abs(m.height()*Math.cos(v)),r=Math.sqrt(z*z+q*q),y=f((n.x<i.x)?m.width():0,(n.y<i.y)?m.height():0),t=Math.tan(p),l=-1/t,j=(l*y.x-y.y-t*i.x+i.y)/(l-t),Aa={x:j,y:l*j-l*y.x+y.y},s=(Math.sqrt(Math.pow(Aa.x-i.x,2)+Math.pow(Aa.y-i.y,2)));for(x=0;x<u;x++){k.push(" "+o[x][1]+" "+((s+r*o[x][0])*100/w)+"%")}m.css({"background-image":F+"linear-gradient("+(-p)+"rad,"+k.join(",")+")"})}}function W(l,j,i){var k=A.Event(l);j.trigger(k,i);if(k.isDefaultPrevented()){return"prevented"}else{if(k.isPropagationStopped()){return"stopped"}else{return""}}}function K(i){function j(k){this.name="TurnJsError";this.message=k}j.prototype=new Error();j.prototype.constructor=j;return new j(i)}function Q(j){var i={top:0,left:0};do{i.left+=j.offsetLeft;i.top+=j.offsetTop}while((j=j.offsetParent));return i}function h(){return(navigator.userAgent.indexOf("MSIE 9.0")==-1)}window.requestAnim=(function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(i){window.setTimeout(i,1000/60)}})();A.extend(A.fn,{flip:function(){return U(A(this[0]),H,arguments)},turn:function(){return U(A(this[0]),S,arguments)},transform:function(k,j){var i={};if(j){i[F+"transform-origin"]=j}i[F+"transform"]=k;return this.css(i)},animatef:function(m){var j=this.data();if(j.effect){j.effect.stop()}if(m){if(!m.to.length){m.to=[m.to]}if(!m.from.length){m.from=[m.from]}var l=[],n=m.to.length,i=true,k=this,p=(new Date()).getTime(),o=function(){if(!j.effect||!i){return}var s=[],t=Math.min(m.duration,(new Date()).getTime()-p);for(var r=0;r<n;r++){s.push(j.effect.easing(1,t,m.from[r],l[r],m.duration))}m.frame((n==1)?s[0]:s);if(t==m.duration){delete j["effect"];k.data(j);if(m.complete){m.complete()}}else{window.requestAnim(o)}};for(var q=0;q<n;q++){l.push(m.to[q]-m.from[q])}j.effect=A.extend({stop:function(){i=false},easing:function(t,u,v,r,s){return r*Math.sqrt(1-(u=u/s-1)*u)+v}},m);this.data(j);o()}else{delete j["effect"]}}});A.isTouch=V;A.mouseEvents=I;A.cssPrefix=e;A.cssTransitionEnd=b;A.findPos=Q})(jQuery);